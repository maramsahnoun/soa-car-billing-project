<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOA Car Rental - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2rem;
            color: #00d4ff;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .logo span {
            color: #00d4ff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        .status-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: #00d4ff;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 212, 255, 0.2);
        }

        .status-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-card .tech {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-ok {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .status-error {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .status-checking {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover, .tab.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .card h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th {
            background: rgba(0, 212, 255, 0.1);
            font-weight: 600;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .result-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-available {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .badge-maintenance {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .refresh-btn {
            background: none;
            border: none;
            color: #00d4ff;
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.3s;
        }

        .refresh-btn:hover {
            transform: rotate(180deg);
        }

        .footer {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 0.9rem;
        }

        .tech-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 0.75rem;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <i class="fas fa-car"></i>
            <h1>SOA <span>Car Rental</span></h1>
        </div>
        <div>
            <span class="tech-badge"><i class="fab fa-node-js"></i> Node.js</span>
            <span class="tech-badge"><i class="fab fa-python"></i> Python</span>
            <span class="tech-badge"><i class="fab fa-java"></i> Java</span>
            <span class="tech-badge"><i class="fab fa-microsoft"></i> .NET</span>
        </div>
    </header>

    <div class="container">
        <!-- Services Status -->
        <section class="status-section">
            <h2 class="section-title">
                <i class="fas fa-heartbeat"></i>
                Services Status
                <button class="refresh-btn" onclick="checkHealth()"><i class="fas fa-sync-alt"></i></button>
            </h2>
            <div class="status-grid" id="statusGrid">
                <!-- Status cards will be populated by JS -->
            </div>
        </section>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('cars')">
                <i class="fas fa-car"></i> Cars
            </div>
            <div class="tab" onclick="showTab('billing')">
                <i class="fas fa-file-invoice-dollar"></i> Billing
            </div>
            <div class="tab" onclick="showTab('reservations')">
                <i class="fas fa-calendar-check"></i> Reservations
            </div>
            <div class="tab" onclick="showTab('maintenance')">
                <i class="fas fa-tools"></i> Maintenance
            </div>
        </div>

        <!-- Cars Tab -->
        <div id="cars" class="tab-content active">
            <div class="card">
                <h3><i class="fas fa-list"></i> Available Cars</h3>
                <button class="btn btn-primary" onclick="loadCars()">
                    <i class="fas fa-refresh"></i> Load Cars
                </button>
                <table class="data-table" id="carsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Brand</th>
                            <th>Model</th>
                            <th>Category</th>
                            <th>Daily Rate (TND)</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="carsBody">
                        <tr><td colspan="6" style="text-align: center; color: #888;">Click "Load Cars" to fetch data</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h3><i class="fas fa-plus"></i> Add New Car</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Registration</label>
                        <input type="text" id="carReg" placeholder="123-TN-456">
                    </div>
                    <div class="form-group">
                        <label>Brand</label>
                        <input type="text" id="carBrand" placeholder="Toyota">
                    </div>
                    <div class="form-group">
                        <label>Model</label>
                        <input type="text" id="carModel" placeholder="Corolla">
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="carCategory">
                            <option value="Citadine">Citadine</option>
                            <option value="Berline">Berline</option>
                            <option value="SUV">SUV</option>
                            <option value="Luxe">Luxe</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Daily Rate (TND)</label>
                        <input type="number" id="carRate" placeholder="100">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addCar()">
                    <i class="fas fa-plus"></i> Add Car
                </button>
                <div id="carResult" class="result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- Billing Tab -->
        <div id="billing" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-plus"></i> Create Payment</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Reservation ID</label>
                        <input type="number" id="payReservationId" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="payStartDate">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="payEndDate">
                    </div>
                    <div class="form-group">
                        <label>Daily Rate (TND)</label>
                        <input type="number" id="payRate" placeholder="80">
                    </div>
                    <div class="form-group">
                        <label>Payment Method</label>
                        <select id="payMethod">
                            <option value="CARTE">Card</option>
                            <option value="ESPECES">Cash</option>
                            <option value="VIREMENT">Transfer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Extras (TND)</label>
                        <input type="number" id="payExtras" placeholder="0">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="createPayment()">
                    <i class="fas fa-credit-card"></i> Create Payment
                </button>
                <div id="paymentResult" class="result-box" style="display: none;"></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-search"></i> Get Invoice</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Payment ID</label>
                        <input type="number" id="invoiceId" placeholder="1">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="getInvoice()">
                    <i class="fas fa-file-invoice"></i> Get Invoice
                </button>
                <div id="invoiceResult" class="result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- Reservations Tab -->
        <div id="reservations" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-list"></i> All Reservations (SOAP)</h3>
                <button class="btn btn-primary" onclick="loadReservations()">
                    <i class="fas fa-refresh"></i> Load Reservations
                </button>
                <div id="reservationsResult" class="result-box" style="display: none;"></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-plus"></i> Create Reservation (SOAP)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Client ID</label>
                        <input type="number" id="resClientId" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label>Car ID</label>
                        <input type="number" id="resCarId" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="resStartDate">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="resEndDate">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="createReservation()">
                    <i class="fas fa-calendar-plus"></i> Create Reservation
                </button>
                <div id="createResResult" class="result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- Maintenance Tab -->
        <div id="maintenance" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-list"></i> All Maintenance Records (SOAP)</h3>
                <button class="btn btn-primary" onclick="loadMaintenance()">
                    <i class="fas fa-refresh"></i> Load Maintenance
                </button>
                <div id="maintenanceResult" class="result-box" style="display: none;"></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-plus"></i> Create Maintenance (SOAP)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Car ID</label>
                        <input type="number" id="maintCarId" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="maintType">
                            <option value="REVISION">Revision</option>
                            <option value="REPARATION">Repair</option>
                            <option value="VIDANGE">Oil Change</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="maintDesc" placeholder="50,000 km service">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="createMaintenance()">
                    <i class="fas fa-wrench"></i> Create Maintenance
                </button>
                <div id="createMaintResult" class="result-box" style="display: none;"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>SOA Car Rental System - Microservices Architecture Demo</p>
        <p>Node.js (REST) • Python FastAPI (REST) • Java JAX-WS (SOAP) • .NET (SOAP)</p>
    </footer>

    <script>
        // Check health on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkHealth();
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach((input, i) => {
                input.value = i % 2 === 0 ? today : nextWeek;
            });
        });

        async function checkHealth() {
            const grid = document.getElementById('statusGrid');
            grid.innerHTML = `
                <div class="status-card">
                    <h3><i class="fas fa-car"></i> Car Service</h3>
                    <p class="tech">Node.js + Express (REST)</p>
                    <span class="status-indicator status-checking"><div class="loading"></div> Checking...</span>
                </div>
                <div class="status-card">
                    <h3><i class="fas fa-file-invoice-dollar"></i> Billing Service</h3>
                    <p class="tech">Python + FastAPI (REST)</p>
                    <span class="status-indicator status-checking"><div class="loading"></div> Checking...</span>
                </div>
                <div class="status-card">
                    <h3><i class="fas fa-calendar-check"></i> Reservation Service</h3>
                    <p class="tech">Java JAX-WS (SOAP)</p>
                    <span class="status-indicator status-checking"><div class="loading"></div> Checking...</span>
                </div>
                <div class="status-card">
                    <h3><i class="fas fa-tools"></i> Maintenance Service</h3>
                    <p class="tech">.NET 8 (SOAP)</p>
                    <span class="status-indicator status-checking"><div class="loading"></div> Checking...</span>
                </div>
            `;

            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                grid.innerHTML = `
                    <div class="status-card">
                        <h3><i class="fas fa-car"></i> Car Service</h3>
                        <p class="tech">Node.js + Express (REST) - Port 3001</p>
                        <span class="status-indicator ${data.car.status === 'OK' ? 'status-ok' : 'status-error'}">
                            <i class="fas fa-${data.car.status === 'OK' ? 'check-circle' : 'times-circle'}"></i>
                            ${data.car.status}
                        </span>
                    </div>
                    <div class="status-card">
                        <h3><i class="fas fa-file-invoice-dollar"></i> Billing Service</h3>
                        <p class="tech">Python + FastAPI (REST) - Port 8001</p>
                        <span class="status-indicator ${data.billing.status === 'OK' ? 'status-ok' : 'status-error'}">
                            <i class="fas fa-${data.billing.status === 'OK' ? 'check-circle' : 'times-circle'}"></i>
                            ${data.billing.status}
                        </span>
                    </div>
                    <div class="status-card">
                        <h3><i class="fas fa-calendar-check"></i> Reservation Service</h3>
                        <p class="tech">Java JAX-WS (SOAP) - Port 8083</p>
                        <span class="status-indicator ${data.reservation.status === 'OK' ? 'status-ok' : 'status-error'}">
                            <i class="fas fa-${data.reservation.status === 'OK' ? 'check-circle' : 'times-circle'}"></i>
                            ${data.reservation.status}
                        </span>
                    </div>
                    <div class="status-card">
                        <h3><i class="fas fa-tools"></i> Maintenance Service</h3>
                        <p class="tech">.NET 8 (SOAP) - Port 5000</p>
                        <span class="status-indicator ${data.maintenance.status === 'OK' ? 'status-ok' : 'status-error'}">
                            <i class="fas fa-${data.maintenance.status === 'OK' ? 'check-circle' : 'times-circle'}"></i>
                            ${data.maintenance.status}
                        </span>
                    </div>
                `;
            } catch (e) {
                console.error('Health check failed:', e);
            }
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        async function loadCars() {
            try {
                const response = await fetch('/api/cars');
                const cars = await response.json();
                const tbody = document.getElementById('carsBody');
                
                if (cars.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No cars found</td></tr>';
                    return;
                }

                tbody.innerHTML = cars.map(car => `
                    <tr>
                        <td>${car.id}</td>
                        <td>${car.marque}</td>
                        <td>${car.modele}</td>
                        <td>${car.categorie}</td>
                        <td>${car.tarif_journalier}</td>
                        <td><span class="badge ${car.etat === 'DISPONIBLE' ? 'badge-available' : 'badge-maintenance'}">${car.etat}</span></td>
                    </tr>
                `).join('');
            } catch (e) {
                alert('Error loading cars: ' + e.message);
            }
        }

        async function addCar() {
            const car = {
                immatriculation: document.getElementById('carReg').value,
                marque: document.getElementById('carBrand').value,
                modele: document.getElementById('carModel').value,
                categorie: document.getElementById('carCategory').value,
                tarif_journalier: parseFloat(document.getElementById('carRate').value),
                etat: 'DISPONIBLE'
            };

            try {
                const response = await fetch('/api/cars', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(car)
                });
                const result = await response.json();
                showResult('carResult', result);
                loadCars();
            } catch (e) {
                showResult('carResult', { error: e.message });
            }
        }

        async function createPayment() {
            const payment = {
                reservation_id: parseInt(document.getElementById('payReservationId').value),
                date_debut: document.getElementById('payStartDate').value,
                date_fin: document.getElementById('payEndDate').value,
                tarif_journalier: parseFloat(document.getElementById('payRate').value),
                mode_paiement: document.getElementById('payMethod').value,
                supplement_options: parseFloat(document.getElementById('payExtras').value) || 0
            };

            try {
                const response = await fetch('/api/payments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payment)
                });
                const result = await response.json();
                showResult('paymentResult', result);
            } catch (e) {
                showResult('paymentResult', { error: e.message });
            }
        }

        async function getInvoice() {
            const id = document.getElementById('invoiceId').value;
            try {
                const response = await fetch(`/api/payments/${id}/invoice`);
                const result = await response.json();
                showResult('invoiceResult', result);
            } catch (e) {
                showResult('invoiceResult', { error: e.message });
            }
        }

        async function loadReservations() {
            try {
                const response = await fetch('/api/reservations/all');
                const result = await response.json();
                showResult('reservationsResult', result);
            } catch (e) {
                showResult('reservationsResult', { error: e.message });
            }
        }

        async function createReservation() {
            const reservation = {
                clientId: parseInt(document.getElementById('resClientId').value),
                carId: parseInt(document.getElementById('resCarId').value),
                startDate: document.getElementById('resStartDate').value,
                endDate: document.getElementById('resEndDate').value
            };

            try {
                const response = await fetch('/api/reservations/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(reservation)
                });
                const result = await response.json();
                showResult('createResResult', result);
            } catch (e) {
                showResult('createResResult', { error: e.message });
            }
        }

        async function loadMaintenance() {
            try {
                const response = await fetch('/api/maintenance/all');
                const result = await response.json();
                showResult('maintenanceResult', result);
            } catch (e) {
                showResult('maintenanceResult', { error: e.message });
            }
        }

        async function createMaintenance() {
            const maintenance = {
                carId: parseInt(document.getElementById('maintCarId').value),
                type: document.getElementById('maintType').value,
                description: document.getElementById('maintDesc').value
            };

            try {
                const response = await fetch('/api/maintenance/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(maintenance)
                });
                const result = await response.json();
                showResult('createMaintResult', result);
            } catch (e) {
                showResult('createMaintResult', { error: e.message });
            }
        }

        function showResult(elementId, data) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>
